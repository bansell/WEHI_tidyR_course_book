<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Week 4. Part 2 | Introduction to R - tidyverse</title>
  <meta name="description" content="Week 4. Part 2 | Introduction to R - tidyverse" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Week 4. Part 2 | Introduction to R - tidyverse" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Week 4. Part 2 | Introduction to R - tidyverse" />
  
  
  

<meta name="author" content="Brendan R. E. Ansell @ansellbr3" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="automating-your-work.html"/>
<link rel="next" href="week-4-part-3.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-162666902-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-162666902-1');
</script>



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-this-book"><i class="fa fa-check"></i>How to use this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#before-we-begin"><i class="fa fa-check"></i>Before we begin</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="week-1-part-1.html"><a href="week-1-part-1.html"><i class="fa fa-check"></i>Week 1. Part 1</a></li>
<li class="chapter" data-level="1" data-path="welcome-to-r.html"><a href="welcome-to-r.html"><i class="fa fa-check"></i><b>1</b> Welcome to R!</a>
<ul>
<li class="chapter" data-level="1.1" data-path="welcome-to-r.html"><a href="welcome-to-r.html#a-look-around-rstudio"><i class="fa fa-check"></i><b>1.1</b> A look around RStudio</a></li>
<li class="chapter" data-level="1.2" data-path="welcome-to-r.html"><a href="welcome-to-r.html#console-pane"><i class="fa fa-check"></i><b>1.2</b> Console Pane</a></li>
<li class="chapter" data-level="1.3" data-path="welcome-to-r.html"><a href="welcome-to-r.html#environmenthistory-pane"><i class="fa fa-check"></i><b>1.3</b> Environment/History Pane</a></li>
<li class="chapter" data-level="1.4" data-path="welcome-to-r.html"><a href="welcome-to-r.html#plotting-pane"><i class="fa fa-check"></i><b>1.4</b> Plotting Pane</a></li>
<li class="chapter" data-level="1.5" data-path="welcome-to-r.html"><a href="welcome-to-r.html#open-a-new-r-script"><i class="fa fa-check"></i><b>1.5</b> Open a new R script</a></li>
<li class="chapter" data-level="1.6" data-path="welcome-to-r.html"><a href="welcome-to-r.html#comments"><i class="fa fa-check"></i><b>1.6</b> Comments</a></li>
<li class="chapter" data-level="1.7" data-path="welcome-to-r.html"><a href="welcome-to-r.html#executing-commands"><i class="fa fa-check"></i><b>1.7</b> Executing commands</a></li>
<li class="chapter" data-level="1.8" data-path="welcome-to-r.html"><a href="welcome-to-r.html#simple-maths-in-r"><i class="fa fa-check"></i><b>1.8</b> Simple maths in R</a></li>
<li class="chapter" data-level="1.9" data-path="welcome-to-r.html"><a href="welcome-to-r.html#help"><i class="fa fa-check"></i><b>1.9</b> Help!!</a></li>
<li class="chapter" data-level="1.10" data-path="welcome-to-r.html"><a href="welcome-to-r.html#variables"><i class="fa fa-check"></i><b>1.10</b> Variables</a>
<ul>
<li class="chapter" data-level="1.10.1" data-path="welcome-to-r.html"><a href="welcome-to-r.html#a-note-on-variables"><i class="fa fa-check"></i><b>1.10.1</b> A note on variables</a></li>
</ul></li>
<li class="chapter" data-level="1.11" data-path="welcome-to-r.html"><a href="welcome-to-r.html#vectors"><i class="fa fa-check"></i><b>1.11</b> Vectors</a>
<ul>
<li class="chapter" data-level="1.11.1" data-path="welcome-to-r.html"><a href="welcome-to-r.html#creating-numeric-vectors"><i class="fa fa-check"></i><b>1.11.1</b> Creating numeric vectors</a></li>
<li class="chapter" data-level="1.11.2" data-path="welcome-to-r.html"><a href="welcome-to-r.html#character-vectors"><i class="fa fa-check"></i><b>1.11.2</b> Character vectors</a></li>
<li class="chapter" data-level="1.11.3" data-path="welcome-to-r.html"><a href="welcome-to-r.html#logical-vectors"><i class="fa fa-check"></i><b>1.11.3</b> Logical vectors</a></li>
</ul></li>
<li class="chapter" data-level="1.12" data-path="welcome-to-r.html"><a href="welcome-to-r.html#packages"><i class="fa fa-check"></i><b>1.12</b> Packages</a>
<ul>
<li class="chapter" data-level="1.12.1" data-path="welcome-to-r.html"><a href="welcome-to-r.html#installing-packages"><i class="fa fa-check"></i><b>1.12.1</b> Installing packages</a></li>
</ul></li>
<li class="chapter" data-level="1.13" data-path="welcome-to-r.html"><a href="welcome-to-r.html#the-pipe"><i class="fa fa-check"></i><b>1.13</b> The pipe %&gt;%</a></li>
<li class="chapter" data-level="1.14" data-path="welcome-to-r.html"><a href="welcome-to-r.html#data-frames"><i class="fa fa-check"></i><b>1.14</b> Data frames</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="week-1-part-2.html"><a href="week-1-part-2.html"><i class="fa fa-check"></i>Week 1. Part 2</a></li>
<li class="chapter" data-level="2" data-path="making-beautiful-plots.html"><a href="making-beautiful-plots.html"><i class="fa fa-check"></i><b>2</b> Making beautiful plots</a>
<ul>
<li class="chapter" data-level="" data-path="making-beautiful-plots.html"><a href="making-beautiful-plots.html#introductory-information"><i class="fa fa-check"></i>Introductory information</a></li>
<li class="chapter" data-level="" data-path="making-beautiful-plots.html"><a href="making-beautiful-plots.html#ggplot2.-a-grammar-of-graphics"><i class="fa fa-check"></i>ggplot2. A grammar of graphics</a></li>
<li class="chapter" data-level="2.1" data-path="making-beautiful-plots.html"><a href="making-beautiful-plots.html#building-a-ggplot"><i class="fa fa-check"></i><b>2.1</b> Building a ggplot</a></li>
<li class="chapter" data-level="2.2" data-path="making-beautiful-plots.html"><a href="making-beautiful-plots.html#plot-background"><i class="fa fa-check"></i><b>2.2</b> Plot background</a></li>
<li class="chapter" data-level="2.3" data-path="making-beautiful-plots.html"><a href="making-beautiful-plots.html#aesthetics-aes"><i class="fa fa-check"></i><b>2.3</b> Aesthetics aes()</a></li>
<li class="chapter" data-level="2.4" data-path="making-beautiful-plots.html"><a href="making-beautiful-plots.html#geometric-representations-geom"><i class="fa fa-check"></i><b>2.4</b> Geometric representations geom()</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="making-beautiful-plots.html"><a href="making-beautiful-plots.html#a-note-about-and"><i class="fa fa-check"></i><b>2.4.1</b> A note about %&gt;% and +</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="making-beautiful-plots.html"><a href="making-beautiful-plots.html#adding-colour"><i class="fa fa-check"></i><b>2.5</b> Adding colour</a></li>
<li class="chapter" data-level="2.6" data-path="making-beautiful-plots.html"><a href="making-beautiful-plots.html#adding-layers"><i class="fa fa-check"></i><b>2.6</b> Adding layers</a></li>
<li class="chapter" data-level="2.7" data-path="making-beautiful-plots.html"><a href="making-beautiful-plots.html#facets"><i class="fa fa-check"></i><b>2.7</b> Facets</a></li>
<li class="chapter" data-level="2.8" data-path="making-beautiful-plots.html"><a href="making-beautiful-plots.html#coordinate-space"><i class="fa fa-check"></i><b>2.8</b> Coordinate space</a></li>
<li class="chapter" data-level="2.9" data-path="making-beautiful-plots.html"><a href="making-beautiful-plots.html#axis-labels"><i class="fa fa-check"></i><b>2.9</b> Axis labels</a></li>
<li class="chapter" data-level="2.10" data-path="making-beautiful-plots.html"><a href="making-beautiful-plots.html#themes"><i class="fa fa-check"></i><b>2.10</b> Themes</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="week-1-part-3.html"><a href="week-1-part-3.html"><i class="fa fa-check"></i>Week 1. Part 3</a></li>
<li class="chapter" data-level="3" data-path="making-more-beautiful-plots.html"><a href="making-more-beautiful-plots.html"><i class="fa fa-check"></i><b>3</b> Making <em>more</em> beautiful plots</a>
<ul>
<li class="chapter" data-level="" data-path="making-more-beautiful-plots.html"><a href="making-more-beautiful-plots.html#introductory-information-1"><i class="fa fa-check"></i>Introductory information</a></li>
<li class="chapter" data-level="3.1" data-path="making-more-beautiful-plots.html"><a href="making-more-beautiful-plots.html#bigger-data-54000-diamonds"><i class="fa fa-check"></i><b>3.1</b> Big(ger) Data: 54,000 diamonds</a></li>
<li class="chapter" data-level="3.2" data-path="making-more-beautiful-plots.html"><a href="making-more-beautiful-plots.html#geom_jitter"><i class="fa fa-check"></i><b>3.2</b> geom_jitter()</a></li>
<li class="chapter" data-level="3.3" data-path="making-more-beautiful-plots.html"><a href="making-more-beautiful-plots.html#summary-plots"><i class="fa fa-check"></i><b>3.3</b> Summary plots</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="making-more-beautiful-plots.html"><a href="making-more-beautiful-plots.html#free-examples"><i class="fa fa-check"></i><b>3.3.1</b> Free examples!</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="making-more-beautiful-plots.html"><a href="making-more-beautiful-plots.html#histograms"><i class="fa fa-check"></i><b>3.4</b> Histograms</a></li>
<li class="chapter" data-level="3.5" data-path="making-more-beautiful-plots.html"><a href="making-more-beautiful-plots.html#density-plots"><i class="fa fa-check"></i><b>3.5</b> Density plots</a></li>
<li class="chapter" data-level="3.6" data-path="making-more-beautiful-plots.html"><a href="making-more-beautiful-plots.html#box-plots"><i class="fa fa-check"></i><b>3.6</b> Box plots</a></li>
<li class="chapter" data-level="3.7" data-path="making-more-beautiful-plots.html"><a href="making-more-beautiful-plots.html#saving-plots"><i class="fa fa-check"></i><b>3.7</b> Saving plots</a></li>
<li class="chapter" data-level="3.8" data-path="making-more-beautiful-plots.html"><a href="making-more-beautiful-plots.html#challenge"><i class="fa fa-check"></i><b>3.8</b> Challenge</a></li>
<li class="chapter" data-level="3.9" data-path="making-more-beautiful-plots.html"><a href="making-more-beautiful-plots.html#solution"><i class="fa fa-check"></i><b>3.9</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="week-2-part-1.html"><a href="week-2-part-1.html"><i class="fa fa-check"></i>Week 2. Part 1</a></li>
<li class="chapter" data-level="4" data-path="sub-setting-vectors.html"><a href="sub-setting-vectors.html"><i class="fa fa-check"></i><b>4</b> Sub-setting vectors</a>
<ul>
<li class="chapter" data-level="4.1" data-path="sub-setting-vectors.html"><a href="sub-setting-vectors.html#subset-by-position"><i class="fa fa-check"></i><b>4.1</b> Subset by position</a></li>
<li class="chapter" data-level="4.2" data-path="sub-setting-vectors.html"><a href="sub-setting-vectors.html#adding-names"><i class="fa fa-check"></i><b>4.2</b> Adding names</a></li>
<li class="chapter" data-level="4.3" data-path="sub-setting-vectors.html"><a href="sub-setting-vectors.html#subset-by-condition"><i class="fa fa-check"></i><b>4.3</b> Subset by condition</a></li>
<li class="chapter" data-level="4.4" data-path="sub-setting-vectors.html"><a href="sub-setting-vectors.html#challenge-1"><i class="fa fa-check"></i><b>4.4</b> Challenge</a></li>
<li class="chapter" data-level="4.5" data-path="sub-setting-vectors.html"><a href="sub-setting-vectors.html#possible-solutions"><i class="fa fa-check"></i><b>4.5</b> Possible solutions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="week-2-part-2.html"><a href="week-2-part-2.html"><i class="fa fa-check"></i>Week 2. Part 2</a></li>
<li class="chapter" data-level="5" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html"><i class="fa fa-check"></i><b>5</b> Manipulating data with dplyr</a>
<ul>
<li class="chapter" data-level="5.1" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#filter"><i class="fa fa-check"></i><b>5.1</b> filter()</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#logical-operations"><i class="fa fa-check"></i><b>5.1.1</b> Logical operations</a></li>
<li class="chapter" data-level="5.1.2" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#str_detect-helper-function"><i class="fa fa-check"></i><b>5.1.2</b> str_detect() helper function</a></li>
<li class="chapter" data-level="5.1.3" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#in-helper"><i class="fa fa-check"></i><b>5.1.3</b> %in% helper</a></li>
<li class="chapter" data-level="5.1.4" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#is.na-helper"><i class="fa fa-check"></i><b>5.1.4</b> is.na() helper</a></li>
<li class="chapter" data-level="5.1.5" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#complete.cases-helper"><i class="fa fa-check"></i><b>5.1.5</b> complete.cases() helper</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#select"><i class="fa fa-check"></i><b>5.2</b> select()</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#contains-helper-function"><i class="fa fa-check"></i><b>5.2.1</b> contains() helper function</a></li>
<li class="chapter" data-level="5.2.2" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#starts_with-helper-function"><i class="fa fa-check"></i><b>5.2.2</b> starts_with() helper function</a></li>
<li class="chapter" data-level="5.2.3" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#everything-helper-function"><i class="fa fa-check"></i><b>5.2.3</b> everything() helper function</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#arrange"><i class="fa fa-check"></i><b>5.3</b> arrange()</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#desc-helper-function"><i class="fa fa-check"></i><b>5.3.1</b> desc() helper function</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#chaining-dplyr-functions"><i class="fa fa-check"></i><b>5.4</b> Chaining dplyr functions</a></li>
<li class="chapter" data-level="5.5" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#writing-data-to-a-file"><i class="fa fa-check"></i><b>5.5</b> Writing data to a file</a></li>
<li class="chapter" data-level="5.6" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#chaining-dplyr-and-ggplot"><i class="fa fa-check"></i><b>5.6</b> Chaining dplyr and ggplot</a></li>
<li class="chapter" data-level="5.7" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#mutate"><i class="fa fa-check"></i><b>5.7</b> mutate()</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#challenge-2"><i class="fa fa-check"></i><b>5.7.1</b> Challenge</a></li>
<li class="chapter" data-level="5.7.2" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#solution-1"><i class="fa fa-check"></i><b>5.7.2</b> Solution</a></li>
<li class="chapter" data-level="5.7.3" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#ifelse-helper"><i class="fa fa-check"></i><b>5.7.3</b> ifelse() helper</a></li>
<li class="chapter" data-level="5.7.4" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#case_when-helper"><i class="fa fa-check"></i><b>5.7.4</b> case_when() helper</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#summarize"><i class="fa fa-check"></i><b>5.8</b> summarize()</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#n-helper"><i class="fa fa-check"></i><b>5.8.1</b> n() helper</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#group_by-helper"><i class="fa fa-check"></i><b>5.9</b> group_by() helper</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#group_by-summarize"><i class="fa fa-check"></i><b>5.9.1</b> group_by() %&gt;% summarize()</a></li>
<li class="chapter" data-level="5.9.2" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#group_by-mutate"><i class="fa fa-check"></i><b>5.9.2</b> group_by() %&gt;% mutate()</a></li>
<li class="chapter" data-level="5.9.3" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#ungroup-helper"><i class="fa fa-check"></i><b>5.9.3</b> ungroup() helper</a></li>
<li class="chapter" data-level="5.9.4" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#count-helper"><i class="fa fa-check"></i><b>5.9.4</b> count() helper</a></li>
<li class="chapter" data-level="5.9.5" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#sample_n-helper"><i class="fa fa-check"></i><b>5.9.5</b> sample_n() helper</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#challenges"><i class="fa fa-check"></i><b>5.10</b> Challenges</a></li>
<li class="chapter" data-level="5.11" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#solutions"><i class="fa fa-check"></i><b>5.11</b> Solutions</a></li>
<li class="chapter" data-level="5.12" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#summary"><i class="fa fa-check"></i><b>5.12</b> Summary</a></li>
<li class="chapter" data-level="5.13" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#cheat-sheets"><i class="fa fa-check"></i><b>5.13</b> Cheat sheets!</a>
<ul>
<li class="chapter" data-level="5.13.1" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#ggplot-example"><i class="fa fa-check"></i><b>5.13.1</b> ggplot example</a></li>
<li class="chapter" data-level="5.13.2" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#dplyr-example"><i class="fa fa-check"></i><b>5.13.2</b> dplyr example</a></li>
</ul></li>
<li class="chapter" data-level="5.14" data-path="manipulating-data-with-dplyr.html"><a href="manipulating-data-with-dplyr.html#extra-resources"><i class="fa fa-check"></i><b>5.14</b> Extra resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="week-3.html"><a href="week-3.html"><i class="fa fa-check"></i>Week 3</a></li>
<li class="chapter" data-level="6" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html"><i class="fa fa-check"></i><b>6</b> Reading, tidying &amp; joining data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#reading-in-data"><i class="fa fa-check"></i><b>6.1</b> Reading in data</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#read_excel"><i class="fa fa-check"></i><b>6.1.1</b> read_excel()</a></li>
<li class="chapter" data-level="6.1.2" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#read_csv"><i class="fa fa-check"></i><b>6.1.2</b> read_csv()</a></li>
<li class="chapter" data-level="6.1.3" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#read_delim"><i class="fa fa-check"></i><b>6.1.3</b> read_delim()</a></li>
<li class="chapter" data-level="6.1.4" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#read_tsv"><i class="fa fa-check"></i><b>6.1.4</b> read_tsv()</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#reshaping-data"><i class="fa fa-check"></i><b>6.2</b> Reshaping data</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#pivot_wider"><i class="fa fa-check"></i><b>6.2.1</b> pivot_wider()</a></li>
<li class="chapter" data-level="6.2.2" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#pivot_longer"><i class="fa fa-check"></i><b>6.2.2</b> pivot_longer()</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#separating-and-uniting-columns"><i class="fa fa-check"></i><b>6.3</b> Separating and uniting columns</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#separate"><i class="fa fa-check"></i><b>6.3.1</b> separate()</a></li>
<li class="chapter" data-level="6.3.2" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#separate_rows"><i class="fa fa-check"></i><b>6.3.2</b> separate_rows()</a></li>
<li class="chapter" data-level="6.3.3" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#rename"><i class="fa fa-check"></i><b>6.3.3</b> rename()</a></li>
<li class="chapter" data-level="6.3.4" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#unite"><i class="fa fa-check"></i><b>6.3.4</b> unite()</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#removing-variables"><i class="fa fa-check"></i><b>6.4</b> Removing variables</a></li>
<li class="chapter" data-level="6.5" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#joining-dataframes"><i class="fa fa-check"></i><b>6.5</b> Joining dataframes</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#left_join"><i class="fa fa-check"></i><b>6.5.1</b> left_join()</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#plotting-challenge"><i class="fa fa-check"></i><b>6.6</b> Plotting challenge</a></li>
<li class="chapter" data-level="6.7" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#bar-chart"><i class="fa fa-check"></i><b>6.7</b> Solution</a></li>
<li class="chapter" data-level="6.8" data-path="reading-tidying-joining-data.html"><a href="reading-tidying-joining-data.html#summary-1"><i class="fa fa-check"></i><b>6.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="week-4-part-1.html"><a href="week-4-part-1.html"><i class="fa fa-check"></i>Week 4. Part 1</a></li>
<li class="chapter" data-level="7" data-path="automating-your-work.html"><a href="automating-your-work.html"><i class="fa fa-check"></i><b>7</b> Automating your work</a>
<ul>
<li class="chapter" data-level="7.1" data-path="automating-your-work.html"><a href="automating-your-work.html#experimental-design"><i class="fa fa-check"></i><b>7.1</b> Experimental design</a></li>
<li class="chapter" data-level="7.2" data-path="automating-your-work.html"><a href="automating-your-work.html#for-loops"><i class="fa fa-check"></i><b>7.2</b> For loops</a></li>
<li class="chapter" data-level="7.3" data-path="automating-your-work.html"><a href="automating-your-work.html#paste"><i class="fa fa-check"></i><b>7.3</b> paste()</a></li>
<li class="chapter" data-level="7.4" data-path="automating-your-work.html"><a href="automating-your-work.html#catching-loop-results"><i class="fa fa-check"></i><b>7.4</b> Catching loop results</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="automating-your-work.html"><a href="automating-your-work.html#catch-in-vector"><i class="fa fa-check"></i><b>7.4.1</b> Catch in vector</a></li>
<li class="chapter" data-level="7.4.2" data-path="automating-your-work.html"><a href="automating-your-work.html#catch-in-data-frame"><i class="fa fa-check"></i><b>7.4.2</b> Catch in data frame</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="week-4-part-2.html"><a href="week-4-part-2.html"><i class="fa fa-check"></i>Week 4. Part 2</a>
<ul>
<li class="chapter" data-level="7.5" data-path="week-4-part-2.html"><a href="week-4-part-2.html#analyse-plate-1"><i class="fa fa-check"></i><b>7.5</b> Analyse Plate 1</a></li>
<li class="chapter" data-level="7.6" data-path="week-4-part-2.html"><a href="week-4-part-2.html#plotting-the-data"><i class="fa fa-check"></i><b>7.6</b> Plotting the data</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="week-4-part-2.html"><a href="week-4-part-2.html#str_remove-helper"><i class="fa fa-check"></i><b>7.6.1</b> str_remove() helper</a></li>
<li class="chapter" data-level="7.6.2" data-path="week-4-part-2.html"><a href="week-4-part-2.html#as.numeric-helper"><i class="fa fa-check"></i><b>7.6.2</b> as.numeric() helper</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="week-4-part-2.html"><a href="week-4-part-2.html#statistical-summary"><i class="fa fa-check"></i><b>7.7</b> Statistical summary</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="week-4-part-2.html"><a href="week-4-part-2.html#pull"><i class="fa fa-check"></i><b>7.7.1</b> pull()</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="week-4-part-2.html"><a href="week-4-part-2.html#identify-hits"><i class="fa fa-check"></i><b>7.8</b> Identify hits</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="week-4-part-3.html"><a href="week-4-part-3.html"><i class="fa fa-check"></i>Week 4. Part 3</a>
<ul>
<li class="chapter" data-level="7.9" data-path="week-4-part-3.html"><a href="week-4-part-3.html#list.files"><i class="fa fa-check"></i><b>7.9</b> list.files()</a></li>
<li class="chapter" data-level="7.10" data-path="week-4-part-3.html"><a href="week-4-part-3.html#extract-filenames"><i class="fa fa-check"></i><b>7.10</b> Extract filenames</a></li>
<li class="chapter" data-level="7.11" data-path="week-4-part-3.html"><a href="week-4-part-3.html#variable-inputs-outputs"><i class="fa fa-check"></i><b>7.11</b> Variable inputs &amp; outputs</a></li>
<li class="chapter" data-level="7.12" data-path="week-4-part-3.html"><a href="week-4-part-3.html#looping-through-plates"><i class="fa fa-check"></i><b>7.12</b> Looping through plates</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="factors.html"><a href="factors.html"><i class="fa fa-check"></i>Factors</a></li>
<li class="chapter" data-level="8" data-path="what-the-factor.html"><a href="what-the-factor.html"><i class="fa fa-check"></i><b>8</b> What the factor?</a>
<ul>
<li class="chapter" data-level="8.1" data-path="what-the-factor.html"><a href="what-the-factor.html#factors-in-plots"><i class="fa fa-check"></i><b>8.1</b> Factors in plots</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="what-the-factor.html"><a href="what-the-factor.html#factors-and-facets"><i class="fa fa-check"></i><b>8.1.1</b> Factors and facets</a></li>
<li class="chapter" data-level="8.1.2" data-path="what-the-factor.html"><a href="what-the-factor.html#factors-and-bar-charts"><i class="fa fa-check"></i><b>8.1.2</b> Factors and bar charts</a></li>
<li class="chapter" data-level="8.1.3" data-path="what-the-factor.html"><a href="what-the-factor.html#reordering-gene-plots"><i class="fa fa-check"></i><b>8.1.3</b> Reordering gene plots</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="what-the-factor.html"><a href="what-the-factor.html#summary-2"><i class="fa fa-check"></i><b>8.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="odds-ends.html"><a href="odds-ends.html"><i class="fa fa-check"></i>Odds &amp; Ends</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to R - tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="week-4.-part-2" class="section level1 unnumbered">
<h1>Week 4. Part 2</h1>
<div id="analyse-plate-1" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Analyse Plate 1</h2>
<p>With the skills for automation in hand, we will now analyse the first plate from the screening assay.<br />
We aim to identify the screening ‘hits’ using both data visualization and statistics.</p>
<p>First we load the tidyverse library and read the raw data (in .csv format) into a variable called ‘screen_plate’</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="week-4-part-2.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb294-2"><a href="week-4-part-2.html#cb294-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-3"><a href="week-4-part-2.html#cb294-3" aria-hidden="true" tabindex="-1"></a>screen_plate <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&#39;~/Desktop/WEHI_tidyR_course/screening_plates/PLATE1.csv&#39;</span>)</span></code></pre></div>
<p>We can check the dimensions of the data frame using dim(), and read the first 6 rows using head()</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="week-4-part-2.html#cb295-1" aria-hidden="true" tabindex="-1"></a>screen_plate <span class="sc">%&gt;%</span> <span class="fu">dim</span>()</span></code></pre></div>
<pre><code>## [1] 32 49</code></pre>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="week-4-part-2.html#cb297-1" aria-hidden="true" tabindex="-1"></a>screen_plate <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 49
##   ROW      C1      C2     C3     C4     C5     C6     C7     C8     C9    C10    C11    C12    C13    C14    C15
##   &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 R1    6174. 187493. 211526 205900 197694 209756 201435 174091 205579 196761 204813 208347 211597 205923 204272
## 2 R2    6368. 197641. 190814 200780 216758 214997 185684 203572 199878 201356 198175 182754 208372 197970 208768
## 3 R3    6959. 193279. 215258 197533 217146 191428 200699 198098 184296 194705 186234 192012 203523 169934 208062
## 4 R4    6106. 185390. 186948 210031 213270 208650 175096 195469 194506 200694 223320 184593 213273 206714 187451
## 5 R5    5919. 201540. 204239 185185 217024 195054 164089 209650 190217 190350 229037 190626 186747 297238 210835
## 6 R6    5408. 203746. 220773 197154 204712 166208 194040 176697 218824 199691 194497 201629 190948 186914 196896
## # … with 33 more variables: C16 &lt;dbl&gt;, C17 &lt;dbl&gt;, C18 &lt;dbl&gt;, C19 &lt;dbl&gt;, C20 &lt;dbl&gt;, C21 &lt;dbl&gt;, C22 &lt;dbl&gt;,
## #   C23 &lt;dbl&gt;, C24 &lt;dbl&gt;, C25 &lt;dbl&gt;, C26 &lt;dbl&gt;, C27 &lt;dbl&gt;, C28 &lt;dbl&gt;, C29 &lt;dbl&gt;, C30 &lt;dbl&gt;, C31 &lt;dbl&gt;,
## #   C32 &lt;dbl&gt;, C33 &lt;dbl&gt;, C34 &lt;dbl&gt;, C35 &lt;dbl&gt;, C36 &lt;dbl&gt;, C37 &lt;dbl&gt;, C38 &lt;dbl&gt;, C39 &lt;dbl&gt;, C40 &lt;dbl&gt;,
## #   C41 &lt;dbl&gt;, C42 &lt;dbl&gt;, C43 &lt;dbl&gt;, C44 &lt;dbl&gt;, C45 &lt;dbl&gt;, C46 &lt;dbl&gt;, C47 &lt;dbl&gt;, C48 &lt;dbl&gt;</code></pre>
<p>So we have a 32-row x 49-column data frame, and using head() we can see that all except the first column are numeric data (you should double-check this using the str() command, which reveals the type of data in each column).<br />
The column names are designated C1, C2, C3 etc, and row identifier column ROW contains R1, R2, R3 etc.</p>
</div>
<div id="plotting-the-data" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> Plotting the data</h2>
<p>Its good practice to look at your entire dataset rather than just relying on statistical summaries. Data visualization will reveal things about your data that basic summary statistics will not. For a nice exposition of this idea, see this <a href="https://www.autodeskresearch.com/publications/samestats">dinasaur-related blog post</a>.</p>
<div class="figure">
<img src="https://fluotics.com/wp-content/uploads/2018/12/1536-plate-2.jpg" alt="" />
<p class="caption"><a href="https://fluotics.com/wp-content/uploads/2018/12/1536-plate-2.jpg" class="uri">https://fluotics.com/wp-content/uploads/2018/12/1536-plate-2.jpg</a></p>
</div>
<p>Given that the 1536-well plate is a grid, we want to make a plot that retains the 2-dimensional features of the plate, showing the relative location of each well.</p>
<p>The ggplot geom_tile() is the best solution for doing this. Let’s grab the example code from the help page</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="week-4-part-2.html#cb299-1" aria-hidden="true" tabindex="-1"></a>?<span class="fu">geom_tile</span>()</span>
<span id="cb299-2"><a href="week-4-part-2.html#cb299-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-3"><a href="week-4-part-2.html#cb299-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Copy and paste the code to make a toy data frame</span></span>
<span id="cb299-4"><a href="week-4-part-2.html#cb299-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb299-5"><a href="week-4-part-2.html#cb299-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">12</span>), <span class="dv">2</span>),</span>
<span id="cb299-6"><a href="week-4-part-2.html#cb299-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">each =</span> <span class="dv">5</span>),</span>
<span id="cb299-7"><a href="week-4-part-2.html#cb299-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">each =</span> <span class="dv">2</span>)),</span>
<span id="cb299-8"><a href="week-4-part-2.html#cb299-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">w =</span> <span class="fu">rep</span>(<span class="fu">diff</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">14</span>)), <span class="dv">2</span>)</span>
<span id="cb299-9"><a href="week-4-part-2.html#cb299-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb299-10"><a href="week-4-part-2.html#cb299-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-11"><a href="week-4-part-2.html#cb299-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Run the 2nd example</span></span>
<span id="cb299-12"><a href="week-4-part-2.html#cb299-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x, y, <span class="at">width =</span> w)) <span class="sc">+</span></span>
<span id="cb299-13"><a href="week-4-part-2.html#cb299-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> z), <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-195-1.png" width="672" /></p>
<p>For screen_plate, we want the ROW ID of the dataframe represented on the y axis, and the columns along the x axis. The raw luminescence values will be used as the colour fill for each tile (as for column ‘z’ above). Therefore we need a dataframe with only 3 columns: corresponding to the x, y, and fill aesthetics. To achieve this we need to reshape the dataframe.</p>
<p>Let’s use pivot_longer() to create a long-format version of the data (“plate_long”). We keep the ROW column as is, and create two new columns: containing the current column IDs (‘COL’), and the respective luminescence values (‘LUMIN’).</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="week-4-part-2.html#cb300-1" aria-hidden="true" tabindex="-1"></a>plate_long <span class="ot">&lt;-</span> screen_plate <span class="sc">%&gt;%</span> </span>
<span id="cb300-2"><a href="week-4-part-2.html#cb300-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&#39;C&#39;</span>), <span class="at">names_to =</span> <span class="st">&#39;COL&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;LUMIN&#39;</span>)</span></code></pre></div>
<p>Now we can make the first plot</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="week-4-part-2.html#cb301-1" aria-hidden="true" tabindex="-1"></a>plate_long <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>COL,<span class="at">y=</span>ROW)) <span class="sc">+</span> <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill=</span>LUMIN))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-197-1.png" width="672" /></p>
<p>The structure in the data is clear, but the rows and columns are all jumbled. This is because they are currently character data, and would work better as integers (numeric data).</p>
<div id="str_remove-helper" class="section level3" number="7.6.1">
<h3><span class="header-section-number">7.6.1</span> str_remove() helper</h3>
<p>To convert the ROW and COL data to numeric, its easiest to remove the letters from the data using str_remove().
str_remove() requires first the column name to modify, and the ‘pattern’ (in our case the letter) to remove.</p>
<p>This function, and other str_ family functions, are often used inside mutate() to create a new column containing the resulting data. However, they can be used to modify a vector of text values, as you will see later in the <a href="week-4-part-3.html#extract-filenames">extract filenames</a> section.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="week-4-part-2.html#cb302-1" aria-hidden="true" tabindex="-1"></a>plate_long <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ROW_num =</span> <span class="fu">str_remove</span>(ROW,<span class="st">&#39;R&#39;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1,536 x 4
##    ROW   COL     LUMIN ROW_num
##    &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;  
##  1 R1    C1      6174. 1      
##  2 R1    C2    187493. 1      
##  3 R1    C3    211526  1      
##  4 R1    C4    205900  1      
##  5 R1    C5    197694  1      
##  6 R1    C6    209756  1      
##  7 R1    C7    201435  1      
##  8 R1    C8    174091  1      
##  9 R1    C9    205579  1      
## 10 R1    C10   196761  1      
## # … with 1,526 more rows</code></pre>
</div>
<div id="as.numeric-helper" class="section level3" number="7.6.2">
<h3><span class="header-section-number">7.6.2</span> as.numeric() helper</h3>
<p>ROW_num is still character data! We need to run a second mutate with as.numeric() to convert ROW_num into numeric data:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="week-4-part-2.html#cb304-1" aria-hidden="true" tabindex="-1"></a>plate_long <span class="sc">%&gt;%</span> </span>
<span id="cb304-2"><a href="week-4-part-2.html#cb304-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ROW_num =</span> <span class="fu">str_remove</span>(ROW,<span class="st">&#39;R&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb304-3"><a href="week-4-part-2.html#cb304-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ROW_num =</span> <span class="fu">as.numeric</span>(ROW_num))</span></code></pre></div>
<pre><code>## # A tibble: 1,536 x 4
##    ROW   COL     LUMIN ROW_num
##    &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 R1    C1      6174.       1
##  2 R1    C2    187493.       1
##  3 R1    C3    211526        1
##  4 R1    C4    205900        1
##  5 R1    C5    197694        1
##  6 R1    C6    209756        1
##  7 R1    C7    201435        1
##  8 R1    C8    174091        1
##  9 R1    C9    205579        1
## 10 R1    C10   196761        1
## # … with 1,526 more rows</code></pre>
<p>We now add two more mutate commands to achieve the same result for the COL IDs, and assign the results to plate_long_num</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="week-4-part-2.html#cb306-1" aria-hidden="true" tabindex="-1"></a>plate_long_num <span class="ot">&lt;-</span> plate_long <span class="sc">%&gt;%</span> </span>
<span id="cb306-2"><a href="week-4-part-2.html#cb306-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ROW_num =</span> <span class="fu">str_remove</span>(ROW,<span class="st">&#39;R&#39;</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ROW_num =</span> <span class="fu">as.numeric</span>(ROW_num)) <span class="sc">%&gt;%</span> </span>
<span id="cb306-3"><a href="week-4-part-2.html#cb306-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">COL_num =</span> <span class="fu">str_remove</span>(COL,<span class="st">&#39;C&#39;</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">COL_num =</span> <span class="fu">as.numeric</span>(COL_num))</span></code></pre></div>
<p>Now let’s run ggplot using the ROW_num and COl_num columns:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="week-4-part-2.html#cb307-1" aria-hidden="true" tabindex="-1"></a>plate_long_num <span class="sc">%&gt;%</span> </span>
<span id="cb307-2"><a href="week-4-part-2.html#cb307-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>COL_num,<span class="at">y=</span>ROW_num)) <span class="sc">+</span> <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill=</span>LUMIN))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-201-1.png" width="672" />
This is looking better. Finally for this plot we can use two scaling commands to<br />
a) change the fill colours a colour-blind-friendly palette that accentuates the high and low values: <code>scale_fill_viridis_c()</code>,<br />
b) and reverse the y axis to mimic the plate coordinates: <code>scale_y_reverse()</code></p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="week-4-part-2.html#cb308-1" aria-hidden="true" tabindex="-1"></a>plate_long_num <span class="sc">%&gt;%</span> </span>
<span id="cb308-2"><a href="week-4-part-2.html#cb308-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>COL_num,<span class="at">y=</span>ROW_num)) <span class="sc">+</span> </span>
<span id="cb308-3"><a href="week-4-part-2.html#cb308-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill=</span>LUMIN)) <span class="sc">+</span></span>
<span id="cb308-4"><a href="week-4-part-2.html#cb308-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb308-5"><a href="week-4-part-2.html#cb308-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-202-1.png" width="672" /></p>
<p>Now please create a new folder within WEHI_tidyR_course/ for the analysis results, called ‘screening_results’. Let’s save the current plot into the new folder using ggsave()</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="week-4-part-2.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&#39;~/Desktop/WEHI_tidyR_course/screening_results/plate_tileplot.pdf&#39;</span>, </span>
<span id="cb309-2"><a href="week-4-part-2.html#cb309-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">width=</span><span class="dv">6</span>, <span class="at">height=</span><span class="fl">3.5</span>)</span></code></pre></div>
</div>
</div>
<div id="statistical-summary" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> Statistical summary</h2>
<p>We can now see there are four entire columns of very low luminescence in screen_plate, corresponding to dead cells. These are the positive controls in columns 1,23,25 and 47. There are also four negative control columns (DMSO-treated cells) at positions 2, 24, 26 and 48. These should be happy and healthy.</p>
<p>Our task is to identify wells with luminescence values &gt; 4 standard deviations from the mean (defined by negative controls), corresponding to a p value &lt; 0.01.</p>
<p>To find these we should first label the columns in the long-format dataframe as ‘test’, ‘posCTRL’ or ‘negCTRL’. Here we use case_when() and the %in% helper to create a column of labels named ‘well_tag’:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="week-4-part-2.html#cb310-1" aria-hidden="true" tabindex="-1"></a>plate_long_num <span class="sc">%&gt;%</span> </span>
<span id="cb310-2"><a href="week-4-part-2.html#cb310-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">well_tag =</span> <span class="fu">case_when</span>(COL_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">23</span>,<span class="dv">25</span>,<span class="dv">47</span>) <span class="sc">~</span> <span class="st">&#39;posCTRL&#39;</span>,</span>
<span id="cb310-3"><a href="week-4-part-2.html#cb310-3" aria-hidden="true" tabindex="-1"></a>                              COL_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">24</span>,<span class="dv">26</span>,<span class="dv">48</span>) <span class="sc">~</span> <span class="st">&#39;negCTRL&#39;</span>,</span>
<span id="cb310-4"><a href="week-4-part-2.html#cb310-4" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&#39;test&#39;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1,536 x 6
##    ROW   COL     LUMIN ROW_num COL_num well_tag
##    &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   
##  1 R1    C1      6174.       1       1 posCTRL 
##  2 R1    C2    187493.       1       2 negCTRL 
##  3 R1    C3    211526        1       3 test    
##  4 R1    C4    205900        1       4 test    
##  5 R1    C5    197694        1       5 test    
##  6 R1    C6    209756        1       6 test    
##  7 R1    C7    201435        1       7 test    
##  8 R1    C8    174091        1       8 test    
##  9 R1    C9    205579        1       9 test    
## 10 R1    C10   196761        1      10 test    
## # … with 1,526 more rows</code></pre>
<p>Let’s store the new data_frame as plate_tagged, and count the number of each type of well.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="week-4-part-2.html#cb312-1" aria-hidden="true" tabindex="-1"></a>plate_tagged <span class="ot">&lt;-</span> plate_long_num <span class="sc">%&gt;%</span> </span>
<span id="cb312-2"><a href="week-4-part-2.html#cb312-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">well_tag =</span> <span class="fu">case_when</span>(COL_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">23</span>,<span class="dv">25</span>,<span class="dv">47</span>) <span class="sc">~</span> <span class="st">&#39;posCTRL&#39;</span>,</span>
<span id="cb312-3"><a href="week-4-part-2.html#cb312-3" aria-hidden="true" tabindex="-1"></a>                              COL_num <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">24</span>,<span class="dv">26</span>,<span class="dv">48</span>) <span class="sc">~</span> <span class="st">&#39;negCTRL&#39;</span>,</span>
<span id="cb312-4"><a href="week-4-part-2.html#cb312-4" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&#39;test&#39;</span>))</span>
<span id="cb312-5"><a href="week-4-part-2.html#cb312-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-6"><a href="week-4-part-2.html#cb312-6" aria-hidden="true" tabindex="-1"></a>plate_tagged <span class="sc">%&gt;%</span> <span class="fu">count</span>(well_tag)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   well_tag     n
##   &lt;chr&gt;    &lt;int&gt;
## 1 negCTRL    128
## 2 posCTRL    128
## 3 test      1280</code></pre>
<p>Now we calculate the mean and standard deviation for the negative control wells only, and assign this summary to ‘neg_summ’</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="week-4-part-2.html#cb314-1" aria-hidden="true" tabindex="-1"></a>neg_summ <span class="ot">&lt;-</span> plate_tagged <span class="sc">%&gt;%</span> </span>
<span id="cb314-2"><a href="week-4-part-2.html#cb314-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(well_tag<span class="sc">==</span><span class="st">&#39;negCTRL&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb314-3"><a href="week-4-part-2.html#cb314-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_neg =</span> <span class="fu">mean</span>(LUMIN),</span>
<span id="cb314-4"><a href="week-4-part-2.html#cb314-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_neg=</span> <span class="fu">sd</span>(LUMIN))</span></code></pre></div>
<div id="pull" class="section level3" number="7.7.1">
<h3><span class="header-section-number">7.7.1</span> pull()</h3>
<p>For a single round of analysis, we might copy these statistics directly into an equation. However here we want the entire analysis to be repeatable on different input datasets, and so can’t have any ‘hard-coded’ numeric values.</p>
<p>To allow the mean and sd to have different values according to the input data, they have to be stored in variables which are then used in a z-score calculation. We need to extract each into a single-value vector.
The pull() function is a handy way to ‘pull’ the values in a dataframe column out into a vector.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="week-4-part-2.html#cb315-1" aria-hidden="true" tabindex="-1"></a>meanNeg <span class="ot">&lt;-</span> neg_summ <span class="sc">%&gt;%</span> <span class="fu">pull</span>(mean_neg)</span>
<span id="cb315-2"><a href="week-4-part-2.html#cb315-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-3"><a href="week-4-part-2.html#cb315-3" aria-hidden="true" tabindex="-1"></a>sdNeg <span class="ot">&lt;-</span> neg_summ <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sd_neg)</span></code></pre></div>
</div>
</div>
<div id="identify-hits" class="section level2" number="7.8">
<h2><span class="header-section-number">7.8</span> Identify hits</h2>
<p>Now let’s use the single values calculated for the mean and standard deviation of negative control wells in a mutate() command and calculate the z score for each well</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="week-4-part-2.html#cb316-1" aria-hidden="true" tabindex="-1"></a>plate_tagged <span class="sc">%&gt;%</span> <span class="fu">filter</span>(well_tag<span class="sc">==</span><span class="st">&#39;test&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb316-2"><a href="week-4-part-2.html#cb316-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_score =</span> (LUMIN <span class="sc">-</span> meanNeg) <span class="sc">/</span> sdNeg) </span></code></pre></div>
<pre><code>## # A tibble: 1,280 x 7
##    ROW   COL    LUMIN ROW_num COL_num well_tag z_score
##    &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;
##  1 R1    C3    211526       1       3 test       1.24 
##  2 R1    C4    205900       1       4 test       0.684
##  3 R1    C5    197694       1       5 test      -0.130
##  4 R1    C6    209756       1       6 test       1.07 
##  5 R1    C7    201435       1       7 test       0.241
##  6 R1    C8    174091       1       8 test      -2.47 
##  7 R1    C9    205579       1       9 test       0.652
##  8 R1    C10   196761       1      10 test      -0.222
##  9 R1    C11   204813       1      11 test       0.576
## 10 R1    C12   208347       1      12 test       0.927
## # … with 1,270 more rows</code></pre>
<p>We can store the result in a data frame ‘plate_zScores’, and make a quick density plot of the z scores to check the distribution (it should be normal and centred on 0)</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="week-4-part-2.html#cb318-1" aria-hidden="true" tabindex="-1"></a>plate_zScores <span class="ot">&lt;-</span> plate_tagged <span class="sc">%&gt;%</span> </span>
<span id="cb318-2"><a href="week-4-part-2.html#cb318-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(well_tag<span class="sc">==</span><span class="st">&#39;test&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb318-3"><a href="week-4-part-2.html#cb318-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_score =</span> (LUMIN <span class="sc">-</span> meanNeg) <span class="sc">/</span> sdNeg) </span></code></pre></div>
<p>Lastly we will create a results table called ‘hits’ for the wells with z scores &lt; -4. These are the wells where the cells are dead or dying. There may also be wells where cells are growing <em>better</em> than controls (z &gt; 4). We will not consider those wells here.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="week-4-part-2.html#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="co">#use &lt; (-4) to avoid typing the assignment operator</span></span>
<span id="cb319-2"><a href="week-4-part-2.html#cb319-2" aria-hidden="true" tabindex="-1"></a>hits <span class="ot">&lt;-</span> plate_zScores <span class="sc">%&gt;%</span> <span class="fu">filter</span>(z_score <span class="sc">&lt;</span> (<span class="sc">-</span><span class="dv">4</span>) )</span></code></pre></div>
<p>And use write_csv() to save it in the to the screening_results folder:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="week-4-part-2.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(hits, <span class="at">path =</span> <span class="st">&#39;~/Desktop/WEHI_tidyR_course/screening_results/plate_hits.csv&#39;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="automating-your-work.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="week-4-part-3.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
